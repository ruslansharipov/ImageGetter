package com.sharipov.imagegetterexample

import androidx.appcompat.app.AppCompatActivity
import android.os.Bundle
import androidx.core.text.HtmlCompat
import com.sharipov.imagegetter.PicassoImageGetter
import com.squareup.picasso.Picasso
import kotlinx.android.synthetic.main.activity_main.*

class MainActivity : AppCompatActivity() {

    companion object {
        const val IMAGE_PREFIX = "http"
    }

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_main)

        val simpleExampleText = "<p class=\"MsoNormal\">Музыка мира в Белом колодце &ndash; одно из тех событий, которого зрители с нетерпением ждут весь год. Концерт проходит на пляже у озера в окружении меловых гор и собирает на своей сцене новых звёзд актуального фолка.</p>\r\n<p>&nbsp;</p>\r\n<p class=\"MsoNormal\" style=\"text-align: center;\"><strong>Naviband (Республика Беларусь)</strong></p>\r\n<p class=\"MsoNormal\" style=\"text-align: center;\">Инди-фолк</p>\r\n<p class=\"MsoNormal\" style=\"text-align: center;\"><a href=\"http://journalby.com/files/styles/1000x1000/public/field/image/navi.jpg\"><img class=\"shift\" src=\"http://journalby.com/files/styles/1000x1000/public/field/image/navi.jpg\" alt=\"\" /><br /></a></p>\r\n<p class=\"MsoNormal\">Одна из самых известных и любимых молодых групп Беларуси. Их романтичные и искренние песни заряжают энергией и дарят тепло.</p>\r\n<p class=\"MsoNormal\">&nbsp;</p>\r\n<p class=\"MsoNormal\">Дважды лауреаты Национальной музыкальной премии &laquo;Лира&raquo;, номинанты премии &laquo;Героі году&raquo;. В 2017 представляли Беларусь на конкурсе &laquo;Евровидение&raquo; с песней &laquo;Гісторыя майго жыцця&raquo;&nbsp;(&laquo;История моей жизни&raquo;).</p>\r\n<p class=\"MsoNormal\">&nbsp;</p>\r\n<p class=\"MsoNormal\">Их сольные концерты проходили в Праге, Варшаве, Москве и Санкт-Петербурге. NaviBand неоднократно участвовали в фестивале&nbsp;&laquo;Дикая мята&raquo;.</p>\r\n<p class=\"MsoNormal\">&nbsp;</p>\r\n<p class=\"MsoNormal\">Вместе с Евгением Гришковцом записали песню &laquo;Колыбельная&raquo;. В&nbsp;МХТ имени Чехова идет спектакль &laquo;Весы&raquo;, музыку к которому написали участники группы &ndash; Артём Лукьяненко и Ксения Жук.</p>\r\n<p class=\"MsoNormal\">&nbsp;</p>\r\n<p class=\"MsoNormal\">В 2017 вышел 4-й альбом Naviband&nbsp;&ndash;&nbsp;&laquo;Адной дарогай&raquo;, с момента релиза занявший первые строчки чартов белорусских&nbsp;iTunes&nbsp;и&nbsp;Google Play Music.</p>\r\n<p class=\"MsoNormal\">&nbsp;</p>\r\n<p class=\"MsoNormal\" style=\"text-align: center;\"><strong>Мэнни Уолтерс (ЮАР)</strong></p>\r\n<p class=\"MsoNormal\" style=\"text-align: center;\">Ритм-энд-блюз, соул</p>\r\n<p style=\"text-align: center;\"><em>Впервые в России!</em></p>\r\n<p style=\"text-align: left;\"><em><a href=\"http://lauramccullagh.com/blog/wp-content/uploads/2015/06/manny-walters_6389.jpg\"><img class=\"shift\" src=\"http://lauramccullagh.com/blog/wp-content/uploads/2015/06/manny-walters_6389.jpg\" alt=\"\" /></a></em></p>\r\n<p class=\"MsoNormal\">Представляем вам экзотического гостя из Южного полушария. Мэнни Уолтерс &ndash; молодой певец и автор песен из ЮАР, в чьей музыке можно услышать влияние ритм-энд-блюза, рока и соула.</p>\r\n<p class=\"MsoNormal\">&nbsp;</p>\r\n<p class=\"MsoNormal\">Мэнни выпустил свой первый EP Anecdotes в 2015, а в 2018 вышел его полноформатный альбом Dark Halo.</p>\r\n<p class=\"MsoNormal\">&nbsp;</p>\r\n<p class=\"MsoNormal\">Сам артист описывает свою музыку как смесь &laquo;электронного ритм-энд-блюза и альтернативного соула&raquo;. Он обладает врожденной музыкальностью, действительно редкой по своей точности и глубине.</p>\r\n<p class=\"MsoNormal\">&nbsp;</p>\r\n<p class=\"MsoNormal\">Формируясь как музыкант под влиянием Ричи Хейвенса, Принса, Стиви Уандера, Марвина Гэя, Трейси Чэпмен, Кёртиса Мэйфилда и Ленни Кравица, Мэнни Уолтерс демонстрирует умеренно интеллектуальный лиризм и страстную душевную энергию, с легкостью очаровывая слушателя.</p>\r\n<p>&nbsp;</p>\r\n<p class=\"MsoNormal\">Надеемся, что наш гость из Кейптауна найдет поклонников среди тех зрителей фестиваля, которые любят музыку, обращающуюся и к сознанию, и к душе.</p>\r\n<p style=\"text-align: left;\"><em> </em></p>\r\n<p><em><br /></em></p>\r\n<p><em> </em></p>\r\n<p>&nbsp;</p>\r\n<p class=\"MsoNormal\" style=\"text-align: center;\"><strong>Eiv&oslash;r (Фарерские острова / Дания)</strong></p>\r\n<p class=\"MsoNormal\" style=\"text-align: center;\">Фолктроника</p>\r\n<p class=\"MsoNormal\" style=\"text-align: center;\"><a href=\"https://farm5.staticflickr.com/4862/45445150625_af3865a00d_h.jpg\"><img class=\"shift\" src=\"https://farm5.staticflickr.com/4862/45445150625_af3865a00d_h.jpg\" alt=\"\" /></a></p>\r\n<p class=\"info\">&nbsp;(c) Lydia Hansen</p>\r\n<p>&nbsp;</p>\r\n<p>&nbsp;</p>\r\n<p class=\"MsoNormal\">Эйвор (или Айвёр) Полсдоттир &ndash; певица с Фарерских островов, сейчас проживающая в Копенгагене. В её творчестве смешиваются элементы джаза, фолка и электроники. За манеру исполнения певицу часто называют фарерской Бьорк.</p>\r\n<p class=\"MsoNormal\">&nbsp;</p>\r\n<p class=\"MsoNormal\">За плечами у Эйвор &ndash; 13 альбомов. Сочиняя музыку, она отталкивается от образа своей родины, поэтому ее песням свойственно мистическое и немного меланхоличное звучание. Среди ее наград &ndash; 18 премий Faroese Music Awards, 3 премии Icelandic Music Awards и 2 премии Danish Music Awards.</p>\r\n<p class=\"MsoNormal\">&nbsp;</p>\r\n<p class=\"MsoNormal\">Эйвор можно услышать в сериале &laquo;Аббатство Даунтон&raquo; и в голливудских фильмах, таких как &laquo;Глубоководный горизонт&raquo; Питера Берга и &laquo;Молчание&raquo; Мартина Скорсезе. Она также написала саундтрек к флагману BBC/Netflix &ndash; сериалу &laquo;Последнее королевство&raquo;.</p>\r\n<p class=\"MsoNormal\">&nbsp;</p>\r\n<p class=\"MsoNormal\" style=\"text-align: right;\"><em>&laquo;Eiv&oslash;r делает звучание фарерской народной музыки мировым хитом&raquo;.</em></p>\r\n<p class=\"MsoNormal\" style=\"text-align: right;\"><strong><em>Wired</em></strong></p>\r\n<p>&nbsp;</p>"
        val exampleText = "<p class=\"MsoNormal\">Музыка мира в Белом колодце &ndash; одно из тех событий, которого зрители с нетерпением ждут весь год. Концерт проходит на пляже у озера в окружении меловых гор и собирает на своей сцене новых звёзд актуального фолка.</p>\r\n<p>&nbsp;</p>\r\n<p class=\"MsoNormal\" style=\"text-align: center;\"><strong>Naviband (Республика Беларусь)</strong></p>\r\n<p class=\"MsoNormal\" style=\"text-align: center;\">Инди-фолк</p>\r\n<p class=\"MsoNormal\" style=\"text-align: center;\"><a href=\"//journalby.com/files/styles/1000x1000/public/field/image/navi.jpg\"><img class=\"shift\" src=\"//journalby.com/files/styles/1000x100  0/public/field/image/navi.jpg\" alt=\"\" /><br /></a></p>\r\n<p class=\"MsoNormal\">Одна из самых известных и любимых молодых групп Беларуси. Их романтичные и искренние песни заряжают энергией и дарят тепло.</p>\r\n<p class=\"MsoNormal\">&nbsp;</p>\r\n<p class=\"MsoNormal\">Дважды лауреаты Национальной музыкальной премии &laquo;Лира&raquo;, номинанты премии &laquo;Героі году&raquo;. В 2017 представляли Беларусь на конкурсе &laquo;Евровидение&raquo; с песней &laquo;Гісторыя майго жыцця&raquo;&nbsp;(&laquo;История моей жизни&raquo;).</p>\r\n<p class=\"MsoNormal\">&nbsp;</p>\r\n<p class=\"MsoNormal\">Их сольные концерты проходили в Праге, Варшаве, Москве и Санкт-Петербурге. NaviBand неоднократно участвовали в фестивале&nbsp;&laquo;Дикая мята&raquo;.</p>\r\n<p class=\"MsoNormal\">&nbsp;</p>\r\n<p class=\"MsoNormal\">Вместе с Евгением Гришковцом записали песню &laquo;Колыбельная&raquo;. В&nbsp;МХТ имени Чехова идет спектакль &laquo;Весы&raquo;, музыку к которому написали участники группы &ndash; Артём Лукьяненко и Ксения Жук.</p>\r\n<p class=\"MsoNormal\">&nbsp;</p>\r\n<p class=\"MsoNormal\">В 2017 вышел 4-й альбом Naviband&nbsp;&ndash;&nbsp;&laquo;Адной дарогай&raquo;, с момента релиза занявший первые строчки чартов белорусских&nbsp;iTunes&nbsp;и&nbsp;Google Play Music.</p>\r\n<p class=\"MsoNormal\">&nbsp;</p>\r\n<p class=\"MsoNormal\" style=\"text-align: center;\"><strong>Мэнни Уолтерс (ЮАР)</strong></p>\r\n<p class=\"MsoNormal\" style=\"text-align: center;\">Ритм-энд-блюз, соул</p>\r\n<p style=\"text-align: center;\"><em>Впервые в России!</em></p>\r\n<p style=\"text-align: left;\"><em><a href=\"://lauramccullagh.com/blog/wp-content/uploads/2015/06/manny-walters_6389.jpg\"><img class=\"shift\" src=\"://lauramccullagh.com/blog/wp-content/uploads/2015/06/manny-walters_6389.jpg\" alt=\"\" /></a></em></p>\r\n<p class=\"MsoNormal\">Представляем вам экзотического гостя из Южного полушария. Мэнни Уолтерс &ndash; молодой певец и автор песен из ЮАР, в чьей музыке можно услышать влияние ритм-энд-блюза, рока и соула.</p>\r\n<p class=\"MsoNormal\">&nbsp;</p>\r\n<p class=\"MsoNormal\">Мэнни выпустил свой первый EP Anecdotes в 2015, а в 2018 вышел его полноформатный альбом Dark Halo.</p>\r\n<p class=\"MsoNormal\">&nbsp;</p>\r\n<p class=\"MsoNormal\">Сам артист описывает свою музыку как смесь &laquo;электронного ритм-энд-блюза и альтернативного соула&raquo;. Он обладает врожденной музыкальностью, действительно редкой по своей точности и глубине.</p>\r\n<p class=\"MsoNormal\">&nbsp;</p>\r\n<p class=\"MsoNormal\">Формируясь как музыкант под влиянием Ричи Хейвенса, Принса, Стиви Уандера, Марвина Гэя, Трейси Чэпмен, Кёртиса Мэйфилда и Ленни Кравица, Мэнни Уолтерс демонстрирует умеренно интеллектуальный лиризм и страстную душевную энергию, с легкостью очаровывая слушателя.</p>\r\n<p>&nbsp;</p>\r\n<p class=\"MsoNormal\">Надеемся, что наш гость из Кейптауна найдет поклонников среди тех зрителей фестиваля, которые любят музыку, обращающуюся и к сознанию, и к душе.</p>\r\n<p style=\"text-align: left;\"><em> </em></p>\r\n<p><em><br /></em></p>\r\n<p><em> </em></p>\r\n<p>&nbsp;</p>\r\n<p class=\"MsoNormal\" style=\"text-align: center;\"><strong>Eiv&oslash;r (Фарерские острова / Дания)</strong></p>\r\n<p class=\"MsoNormal\" style=\"text-align: center;\">Фолктроника</p>\r\n<p class=\"MsoNormal\" style=\"text-align: center;\"><a href=\"https://farm5.staticflickr.com/4862/45445150625_af3865a00d_h.jpg\"><img class=\"shift\" src=\"https://farm5.staticflickr.com/4862/45445150625_af3865a00d_h.jpg\" alt=\"\" /></a></p>\r\n<p class=\"info\">&nbsp;(c) Lydia Hansen</p>\r\n<p>&nbsp;</p>\r\n<p>&nbsp;</p>\r\n<p class=\"MsoNormal\">Эйвор (или Айвёр) Полсдоттир &ndash; певица с Фарерских островов, сейчас проживающая в Копенгагене. В её творчестве смешиваются элементы джаза, фолка и электроники. За манеру исполнения певицу часто называют фарерской Бьорк.</p>\r\n<p class=\"MsoNormal\">&nbsp;</p>\r\n<p class=\"MsoNormal\">За плечами у Эйвор &ndash; 13 альбомов. Сочиняя музыку, она отталкивается от образа своей родины, поэтому ее песням свойственно мистическое и немного меланхоличное звучание. Среди ее наград &ndash; 18 премий Faroese Music Awards, 3 премии Icelandic Music Awards и 2 премии Danish Music Awards.</p>\r\n<p class=\"MsoNormal\">&nbsp;</p>\r\n<p class=\"MsoNormal\">Эйвор можно услышать в сериале &laquo;Аббатство Даунтон&raquo; и в голливудских фильмах, таких как &laquo;Глубоководный горизонт&raquo; Питера Берга и &laquo;Молчание&raquo; Мартина Скорсезе. Она также написала саундтрек к флагману BBC/Netflix &ndash; сериалу &laquo;Последнее королевство&raquo;.</p>\r\n<p class=\"MsoNormal\">&nbsp;</p>\r\n<p class=\"MsoNormal\" style=\"text-align: right;\"><em>&laquo;Eiv&oslash;r делает звучание фарерской народной музыки мировым хитом&raquo;.</em></p>\r\n<p class=\"MsoNormal\" style=\"text-align: right;\"><strong><em>Wired</em></strong></p>\r\n<p>&nbsp;</p>"

        simpleTextView.run {
            val simpleGetter = PicassoImageGetter(Picasso.get(), this)
            text = HtmlCompat.fromHtml(simpleExampleText, HtmlCompat.FROM_HTML_MODE_LEGACY, simpleGetter, null)
        }

        exampleTextView.run {
            val exampleGetter = PicassoImageGetter().apply {
                picasso = Picasso.get()
                textView = this@run
                placeHolderRes = R.drawable.ic_image_black
                errorDrawableRes = R.drawable.ic_error_black
                urlEditor = { source: String ->
                    when {
                        source.startsWith(":") -> "$IMAGE_PREFIX$source"
                        source.startsWith("/") -> "$IMAGE_PREFIX:$source"
                        else -> source
                    }
                }
            }
            text = HtmlCompat.fromHtml(exampleText, HtmlCompat.FROM_HTML_MODE_LEGACY, exampleGetter, null)
        }
    }
}
